if test ${distro_bootpart} != 1 && test ${devtype} != "ubi"
then
    echo "Boot partition needs to be the first partition"
    exit
fi

if test -z "${altbootcmd}"
then
    env set altbootcmd 'env set rollback 1; run bootcmd'
    env save
fi

if test ${devtype} != ubi
then
    ext4load ${devtype} ${devnum}:2 ${loadaddr} /boot/loader/uEnv.txt; env import -t ${loadaddr} ${filesize}
else
    ubifsmount ubi${devnum}:rootfs && load ${devtype} ${devnum}:2 ${loadaddr} /boot/loader/uEnv.txt; env import -t ${loadaddr} ${filesize}
fi

run bootcmd_run
